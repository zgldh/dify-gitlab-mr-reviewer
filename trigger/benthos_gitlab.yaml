input:
  http_server:
    address: ""
    path: /
    allowed_verbs: [ POST ]
    timeout: 30m

pipeline:
  processors:
    - bloblang: |
        root = { 
          "inputs": {
            "payload": content().string()
          },
          "response_mode": "blocking",
          "user": "AiCodeReview" 
        }
    - log:
        level: INFO
        message: "Processing GitLab hook request"

output:
  http_client:
    url: ${! metadata("dify") }
    verb: POST
    headers:
      Authorization: 'Bearer ${! metadata("X-Gitlab-Token") }'
      Content-Type: application/json
    timeout: 30m
    propagate_response: true

logger:
  level: INFO
  format: logfmt
  add_timestamp: true
  static_fields:
    '@service': ai-code-reviewer-trigger-connect